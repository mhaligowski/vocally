!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("d3-time"),require("d3-time-format"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","vega-util","d3-time","d3-time-format","d3-array"],t):t((e=e||self).vega={},e.vega,e.d3,e.d3,e.d3)}(this,(function(e,t,n,r,o){"use strict";const i="year",u="quarter",a="month",c="week",s="date",f="day",l="hours",d="minutes",m="seconds",y=[i,u,a,c,s,f,"dayofyear",l,d,m,"milliseconds"],g=y.reduce((e,t,n)=>(e[t]=1+n,e),{});function D(e){const n=t.array(e).slice(),r={};return n.length||t.error("Missing time unit."),n.forEach(e=>{t.hasOwnProperty(g,e)?r[e]=1:t.error(`Invalid time unit: ${e}.`)}),(r[c]||r.day?1:0)+(r[u]||r[a]||r[s]?1:0)+(r.dayofyear?1:0)>1&&t.error("Incompatible time units: "+e),n.sort((e,t)=>g[e]-g[t]),n}const M=new Date;function h(e){return M.setFullYear(e),M.setMonth(0),M.setDate(1),M.setHours(0,0,0,0),M}function T(e){return n.timeDay.count(h(e.getFullYear())-1,e)}function U(e){return n.timeWeek.count(h(e.getFullYear())-1,e)}function C(e){return h(e).getDay()}function p(e,t,n,r,o,i,u){if(0<=e&&e<100){var a=new Date(-1,t,n,r,o,i,u);return a.setFullYear(e),a}return new Date(e,t,n,r,o,i,u)}function v(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return n.utcDay.count(t-1,e)}function F(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return n.utcWeek.count(t-1,e)}function Y(e){return M.setTime(Date.UTC(e,0,1)),M.getUTCDay()}function w(e,t,n,r,o,i,u){if(0<=e&&e<100){var a=new Date(Date.UTC(-1,t,n,r,o,i,u));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,r,o,i,u))}function S(e,n,r,o,y){const g=n||1,D=t.peek(e),M=(e,t,n)=>function(e,t,n,r){const o=n<=1?e:r?(t,o)=>r+n*Math.floor((e(t,o)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(o(e,n),n):o}(r[n=n||e],o[n],e===D&&g,t),h=new Date,T=t.toSet(e),U=T[i]?M(i):t.constant(2012),C=T[a]?M(a):T[u]?M(u):t.zero,p=T[c]&&T.day?M(f,1,c+f):T[c]?M(c,1):T.day?M(f,1):T[s]?M(s,1):T.dayofyear?M("dayofyear",1):t.one,v=T[l]?M(l):t.zero,F=T[d]?M(d):t.zero,Y=T[m]?M(m):t.zero,w=T.milliseconds?M("milliseconds"):t.zero;return function(e){h.setTime(+e);const t=U(h);return y(t,C(h),p(h,t),v(h),F(h),Y(h),w(h))}}function k(e,t,n){return t+7*e-(n+6)%7}const b={[i]:e=>e.getFullYear(),[u]:e=>Math.floor(e.getMonth()/3),[a]:e=>e.getMonth(),[s]:e=>e.getDate(),[l]:e=>e.getHours(),[d]:e=>e.getMinutes(),[m]:e=>e.getSeconds(),milliseconds:e=>e.getMilliseconds(),dayofyear:e=>T(e),[c]:e=>U(e),[c+f]:(e,t)=>k(U(e),e.getDay(),C(t)),[f]:(e,t)=>k(1,e.getDay(),C(t))},I={[u]:e=>3*e,[c]:(e,t)=>k(e,0,C(t))};const q={[i]:e=>e.getUTCFullYear(),[u]:e=>Math.floor(e.getUTCMonth()/3),[a]:e=>e.getUTCMonth(),[s]:e=>e.getUTCDate(),[l]:e=>e.getUTCHours(),[d]:e=>e.getUTCMinutes(),[m]:e=>e.getUTCSeconds(),milliseconds:e=>e.getUTCMilliseconds(),dayofyear:e=>v(e),[c]:e=>F(e),[f]:(e,t)=>k(1,e.getUTCDay(),Y(t)),[c+f]:(e,t)=>k(F(e),e.getUTCDay(),Y(t))},x={[u]:e=>3*e,[c]:(e,t)=>k(e,0,Y(t))};const H={[i]:n.timeYear,[u]:n.timeMonth.every(3),[a]:n.timeMonth,[c]:n.timeWeek,[s]:n.timeDay,[f]:n.timeDay,dayofyear:n.timeDay,[l]:n.timeHour,[d]:n.timeMinute,[m]:n.timeSecond,milliseconds:n.timeMillisecond},j={[i]:n.utcYear,[u]:n.utcMonth.every(3),[a]:n.utcMonth,[c]:n.utcWeek,[s]:n.utcDay,[f]:n.utcDay,dayofyear:n.utcDay,[l]:n.utcHour,[d]:n.utcMinute,[m]:n.utcSecond,milliseconds:n.utcMillisecond};function z(e){return H[e]}function O(e){return j[e]}function W(e,t,n){return e?e.offset(t,n):void 0}function B(e,t,n,r){return e?e.range(t,n,r):void 0}const _={[i]:"%Y ",[u]:"Q%q ",[a]:"%b ",[s]:"%d ",[c]:"W%U ",[f]:"%a ",dayofyear:"%j ",[l]:"%H:00",[d]:"00:%M",[m]:":%S",milliseconds:".%L","year-month":"%Y-%m ","year-month-date":"%Y-%m-%d ",["hours-"+d]:"%H:%M"};function E(e,n,r){return t.isString(r)?e(r):function(e,n,r){r=r||{},t.isObject(r)||t.error("Invalid time multi-format specifier: "+r);const o=n(m),f=n(d),y=n(l),g=n(s),D=n(c),M=n(a),h=n(u),T=n(i),U=e(r.milliseconds||".%L"),C=e(r[m]||":%S"),p=e(r[d]||"%I:%M"),v=e(r[l]||"%I %p"),F=e(r[s]||r.day||"%a %d"),Y=e(r[c]||"%b %d"),w=e(r[a]||"%B"),S=e(r[u]||"%B"),k=e(r[i]||"%Y");return function(e){return(o(e)<e?U:f(e)<e?C:y(e)<e?p:g(e)<e?v:M(e)<e?D(e)<e?F:Y:T(e)<e?h(e)<e?w:S:k)(e)}}(e,n,r)}const L=[i,a,s,l,d,m,"milliseconds"],P=L.slice(0,-1),N=P.slice(0,-1),Q=N.slice(0,-1),$=Q.slice(0,-1),A=[i,a],G=[i],J=[[P,1,1e3],[P,5,5e3],[P,15,15e3],[P,30,3e4],[N,1,6e4],[N,5,3e5],[N,15,9e5],[N,30,18e5],[Q,1,36e5],[Q,3,108e5],[Q,6,216e5],[Q,12,432e5],[$,1,864e5],[[i,c],1,6048e5],[A,1,2592e6],[A,3,7776e6],[G,1,31536e6]];e.TIME_UNITS=y,e.dayofyear=function(e){return T(new Date(e))},e.timeBin=function(e){const n=e.extent,r=e.maxbins||40,i=Math.abs(t.span(n))/r;let u,a,c=o.bisector(e=>e[2]).right(J,i);return c===J.length?(u=G,a=o.tickStep(n[0]/31536e6,n[1]/31536e6,r)):c?(c=J[i/J[c-1][2]<J[c][2]/i?c-1:c],u=c[0],a=c[1]):(u=L,a=Math.max(o.tickStep(n[0],n[1],r),1)),{units:u,step:a}},e.timeFloor=function(e,t){return S(e,t||1,b,I,p)},e.timeFormat=function(e){return E(r.timeFormat,z,e)},e.timeInterval=z,e.timeOffset=function(e,t,n){return W(z(e),t,n)},e.timeSequence=function(e,t,n,r){return B(z(e),t,n,r)},e.timeUnitSpecifier=function(e,n){const r=t.extend({},_,n),o=D(e),i=o.length;let u,a,c="",s=0;for(s=0;s<i;)for(u=o.length;u>s;--u)if(a=o.slice(s,u).join("-"),null!=r[a]){c+=r[a],s=u;break}return c.trim()},e.timeUnits=D,e.utcFloor=function(e,t){return S(e,t||1,q,x,w)},e.utcFormat=function(e){return E(r.utcFormat,O,e)},e.utcInterval=O,e.utcOffset=function(e,t,n){return W(O(e),t,n)},e.utcSequence=function(e,t,n,r){return B(O(e),t,n,r)},e.utcdayofyear=function(e){return v(new Date(e))},e.utcweek=function(e){return F(new Date(e))},e.week=function(e){return U(new Date(e))},Object.defineProperty(e,"__esModule",{value:!0})}));